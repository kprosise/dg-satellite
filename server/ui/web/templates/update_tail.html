{{ template "header" .}}
    <section class="content-section">
      <h2>{{.Title}}</h2>
    </section>

    <section class="content-section">
      <h3>Logs</h3>
      <pre id="tail-logs"></pre>
    </section>

    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const tailLogs = document.getElementById('tail-logs');
        const url = '{{.TailUrl}}';
        
        console.log('Connecting to EventSource:', url);
        tailLogs.textContent += '[Connecting to log stream: ' + url + ']\n';
        
        const eventSource = new EventSource(url);
        
        eventSource.onopen = function(event) {
          tailLogs.textContent += '[Connection established]\n';
        };
        
        eventSource.onmessage = function(event) {
          tailLogs.textContent += event.data + '\n';
          // Auto-scroll to bottom to follow the logs
          tailLogs.scrollTop = tailLogs.scrollHeight;
        };

        eventSource.addEventListener("log", (event) => {
          try {
            const data = JSON.parse(event.data);
            tailLogs.textContent += data.uuid + ': ' + data.status + '\n';
          } catch (e) {
            // Fallback to raw data if not valid JSON
            tailLogs.textContent += event.data + '\n';
          }
          tailLogs.scrollTop = tailLogs.scrollHeight;
        });
        
        eventSource.onerror = function(event) {
          console.error('EventSource error:', event);
          console.log('EventSource readyState:', eventSource.readyState);
          
          let errorMsg = '[Connection error';
          if (eventSource.readyState === EventSource.CONNECTING) {
            errorMsg += ' - connecting...';
          } else if (eventSource.readyState === EventSource.CLOSED) {
            errorMsg += ' - connection closed';
          }
          errorMsg += ']\n';
          
          tailLogs.textContent += errorMsg;
        };
        
        window.addEventListener('beforeunload', function() {
          eventSource.close();
        });
      });
    </script>

{{ template "footer"}}
