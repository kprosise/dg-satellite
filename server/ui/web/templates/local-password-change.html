{{/* Used by the auth package's localProvider implementation */}}
{{ template "header" .}}
    <section class="content-section">
      <h2>{{.Title}}</h2>
      {{if .Message}}
      <section>
        <mark>{{.Message}}</mark>
      </section>
      {{end}}

      <form id="passwordChangeForm">
        <fieldset>
          <legend><strong>Current Password</strong></legend>
          <input type="password" name="currentPassword" id="currentPassword" required />
        </fieldset>
        
        <fieldset>
          <legend><strong>New Password</strong></legend>
          <input type="password" name="newPassword" id="newPassword" required />
        </fieldset>
        
        <fieldset>
          <legend><strong>Confirm New Password</strong></legend>
          <input type="password" name="confirmNewPassword" id="confirmNewPassword" required />
          <span id="passwordError" style="color: red; display: none;">Passwords do not match</span>
        </fieldset>

        <button type="submit">Change password</button>
      </form>
      
      {{ template "password_change_script" . }}
      <script>
        document.getElementById('passwordChangeForm').addEventListener('submit', function(e) {
          e.preventDefault();

          var newPassword = document.getElementById('newPassword').value;
          var confirmPassword = document.getElementById('confirmNewPassword').value;
          var errorSpan = document.getElementById('passwordError');

          if (newPassword !== confirmPassword) {
            errorSpan.style.display = 'inline';
            return false;
          }
          errorSpan.style.display = 'none';

          var currentPassword = document.getElementById('currentPassword').value;
          submitPasswordChange(currentPassword, newPassword, confirmPassword, function() {
            window.location.reload();
          });
        });

        setupPasswordMatchValidation('newPassword', 'confirmNewPassword', 'passwordError');
      </script>
    </section>

{{ template "footer"}}
